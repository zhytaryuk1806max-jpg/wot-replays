<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Fershteyn09 ‚Äî WOT Replay</title>
  <style>
    body {
      margin: 0;
      font-family: 'Poppins', sans-serif;
      color: #ffffff;
      background: url("Evolution_Key_logo-V2-a534739934edf3831f93.jpg") no-repeat center center fixed;
      background-size: cover;
    }

    header {
      background: #1a1a1a;
      padding: 30px 20px;
      text-align: center;
      border-bottom: 3px solid #ff6600;
    }

    header h1 {
      margin: 0;
      font-size: 2.5rem;
      color: #ff6600;
    }

    main {
      max-width: 1200px;
      margin: 30px auto;
      padding: 0 20px;
    }

    .controls {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 10px;
      margin-bottom: 30px;
    }

    .controls input, .controls select, .controls button {
      padding: 10px;
      border-radius: 8px;
      border: 1px solid #ff6600;
      font-size: 1rem;
      width: 80%;
      background: #1a1a1a;
      color: #ffffff;
    }

    .controls button {
      background: #ff6600;
      color: #000;
      font-weight: bold;
      cursor: pointer;
    }

    .controls button:hover {
      background: #e55b00;
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
    }

    .replay-card {
      background: #1a1a1a;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 4px 15px rgba(255,102,0,0.4);
      display: flex;
      flex-direction: column;
      padding: 15px;
      position: relative;
    }

    .replay-card img {
      width: 100%;
      height: 150px;
      object-fit: cover;
      border-radius: 8px;
      margin-bottom: 10px;
      cursor: pointer;
    }

    .replay-card input {
      width: 100%;
      padding: 5px;
      border-radius: 6px;
      border: 1px solid #ff6600;
      margin-bottom: 5px;
      background: #1a1a1a;
      color: #ffffff;
    }

    .status-badge {
      position: absolute;
      top: 10px;
      left: 10px;
      padding: 5px 10px;
      border-radius: 8px;
      font-weight: bold;
      color: #fff;
      font-size: 0.9rem;
    }

    .status-win { background: #28a745; }
    .status-lose { background: #dc3545; }

    .replay-card a, .replay-card button {
      text-decoration: none;
      background: #ff6600;
      color: #000;
      padding: 8px 15px;
      border-radius: 8px;
      text-align: center;
      display: block;
      margin: 5px 0;
      cursor: pointer;
      border: none;
      transition: background 0.3s;
    }

    .replay-card a:hover, .replay-card button:hover { background: #e55b00; }

    footer {
      text-align: center;
      padding: 20px;
      font-size: 0.85rem;
      color: #fff;
      border-top: 3px solid #ff6600;
      margin-top: 30px;
    }

    #toggleMusicBtn {
      position: fixed;
      bottom: 20px;
      right: 20px;
      padding: 10px 20px;
      background: #ff6600;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      z-index: 1000;
    }
  </style>
</head>
<body>
  <header>
    <h1>Fershteyn09 ‚Äî WOT Replay</h1>
  </header>

  <main>
    <div class="controls">
      <input type="text" id="replayURL" placeholder="–ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ Google Drive (–¥–ª—è —Å–∫–∞—á—É–≤–∞–Ω–Ω—è)">
      <input type="text" id="replayDesc" placeholder="–û–ø–∏—Å –±–æ—é">
      <input type="file" id="previewInput" accept="image/*">
      <select id="replayStatus">
        <option value="–ü–µ—Ä–µ–º–æ–≥–∞">–ü–µ—Ä–µ–º–æ–≥–∞ üèÜ</option>
        <option value="–ü–æ—Ä–∞–∑–∫–∞">–ü–æ—Ä–∞–∑–∫–∞ üíÄ</option>
      </select>
      <button id="addReplay">–î–æ–¥–∞—Ç–∏ —Ä–µ–ø–ª–µ–π</button>
    </div>

    <div class="grid" id="replayGrid"></div>
  </main>

  <footer>
    ¬© 2025 Fershteyn09 ‚Äî –†–µ–ø–ª–µ—ó –¥–ª—è –æ—Å–æ–±–∏—Å—Ç–æ–≥–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è
  </footer>

  <!-- –ú—É–∑–∏–∫–∞ -->
  <audio id="bg-music" src="music.mp3" loop autoplay></audio>
  <button id="toggleMusicBtn">üéµ –í–∏–º–∫–Ω—É—Ç–∏ –º—É–∑–∏–∫—É</button>

  <script>
    // --- –ú—É–∑–∏–∫–∞ ---
    const music = document.getElementById("bg-music");
    const btn = document.getElementById("toggleMusicBtn");

    music.volume = 0.5;
    music.play().catch(() => {
      music.pause();
      btn.textContent = "üéµ –£–≤—ñ–º–∫–Ω—É—Ç–∏ –º—É–∑–∏–∫—É";
    });

    btn.addEventListener("click", () => {
      if (music.paused) {
        music.play();
        btn.textContent = "üéµ –í–∏–º–∫–Ω—É—Ç–∏ –º—É–∑–∏–∫—É";
      } else {
        music.pause();
        btn.textContent = "üéµ –£–≤—ñ–º–∫–Ω—É—Ç–∏ –º—É–∑–∏–∫—É";
      }
    });

    // --- –†–µ–ø–ª–µ—ó ---
    const replayURLInput = document.getElementById('replayURL');
    const previewInput = document.getElementById('previewInput');
    const replayDesc = document.getElementById('replayDesc');
    const replayStatus = document.getElementById('replayStatus');
    const addReplayBtn = document.getElementById('addReplay');
    const replayGrid = document.getElementById('replayGrid');

    document.addEventListener('DOMContentLoaded', () => {
      const savedReplays = JSON.parse(localStorage.getItem('wotReplays') || '[]');
      savedReplays.forEach(data => addReplayCard(data));
    });

    addReplayBtn.addEventListener('click', () => {
      const url = replayURLInput.value.trim();
      if (!url) {
        alert("–í–≤–µ–¥—ñ—Ç—å –ø–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ Google Drive!");
        return;
      }

      const driveIdMatch = url.match(/\/d\/([a-zA-Z0-9_-]+)/);
      if (!driveIdMatch) {
        alert("–ù–µ–∫–æ—Ä–µ–∫—Ç–Ω–µ –ø–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ Google Drive!");
        return;
      }

      const downloadURL = `https://drive.google.com/uc?export=download&id=${driveIdMatch[1]}`;

      if (previewInput.files[0]) {
        const reader = new FileReader();
        reader.onload = function(e) {
          saveAndAddReplay({
            url: downloadURL,
            description: replayDesc.value || "–ë–µ–∑ –æ–ø–∏—Å—É",
            status: replayStatus.value,
            preview: e.target.result
          });
        };
        reader.readAsDataURL(previewInput.files[0]);
      } else {
        saveAndAddReplay({
          url: downloadURL,
          description: replayDesc.value || "–ë–µ–∑ –æ–ø–∏—Å—É",
          status: replayStatus.value,
          preview: null
        });
      }

      replayURLInput.value = '';
      replayDesc.value = '';
      previewInput.value = '';
      replayStatus.value = "–ü–µ—Ä–µ–º–æ–≥–∞";
    });

    function saveAndAddReplay(data) {
      const savedReplays = JSON.parse(localStorage.getItem('wotReplays') || '[]');
      savedReplays.push(data);
      localStorage.setItem('wotReplays', JSON.stringify(savedReplays));
      addReplayCard(data);
    }

    function addReplayCard(data) {
      const card = document.createElement('div');
      card.className = 'replay-card';

      const statusBadge = document.createElement('div');
      statusBadge.className = 'status-badge ' + (data.status === "–ü–µ—Ä–µ–º–æ–≥–∞" ? "status-win" : "status-lose");
      statusBadge.textContent = data.status;

      const img = document.createElement('img');
      img.src = data.preview || 'https://via.placeholder.com/300x150?text=WOT+Replay';
      img.title = "–ö–ª—ñ–∫–Ω—ñ—Ç—å –¥–ª—è –∑–º—ñ–Ω–∏ –ø—Ä–µ–≤‚Äô—é";
      img.addEventListener('click', () => {
        const input = document.createElement('input');
        input.type = 'file';
        input.accept = 'image/*';
        input.onchange = e => {
          const file = e.target.files[0];
          if (!file) return;
          const reader = new FileReader();
          reader.onload = ev => {
            img.src = ev.target.result;
            updateReplay(data.url, { preview: ev.target.result });
          };
          reader.readAsDataURL(file);
        };
        input.click();
      });

      const descInput = document.createElement('input');
      descInput.type = 'text';
      descInput.value = data.description;
      descInput.addEventListener('change', () => {
        updateReplay(data.url, { description: descInput.value });
      });

      const downloadBtn = document.createElement('a');
      downloadBtn.href = data.url;
      downloadBtn.download = '';
      downloadBtn.textContent = "–°–∫–∞—á–∞—Ç–∏";
      downloadBtn.target = "_blank";

      const deleteBtn = document.createElement('button');
      deleteBtn.textContent = "–í–∏–¥–∞–ª–∏—Ç–∏";
      deleteBtn.addEventListener('click', () => {
        let savedReplays = JSON.parse(localStorage.getItem('wotReplays') || '[]');
        savedReplays = savedReplays.filter(r => r.url !== data.url);
        localStorage.setItem('wotReplays', JSON.stringify(savedReplays));
        card.remove();
      });

      card.appendChild(statusBadge);
      card.appendChild(img);
      card.appendChild(descInput);
      card.appendChild(downloadBtn);
      card.appendChild(deleteBtn);

      replayGrid.appendChild(card);
    }

    function updateReplay(url, updates) {
      const savedReplays = JSON.parse(localStorage.getItem('wotReplays') || '[]');
      const index = savedReplays.findIndex(r => r.url === url);
      if (index !== -1) {
        savedReplays[index] = { ...savedReplays[index], ...updates };
        localStorage.setItem('wotReplays', JSON.stringify(savedReplays));
      }
    }
  </script>
</body>
</html>
